---
import { Image } from "astro:assets";
import banner1 from "../assets/img/banner1.webp";
import banner2 from "../assets/img/banner2.webp";
import banner3 from "../assets/img/banner3.jpg";
import banner4 from "../assets/img/banner4.webp";
import banner5 from "../assets/img/banner5.webp";
import banner6 from "../assets/img/banner6.webp";
import banner7 from "../assets/img/banner7.webp";
import banner8 from "../assets/img/banner8.webp";
import banner9 from "../assets/img/banner9.webp";
import banner10 from "../assets/img/banner10.webp";
import banner11 from "../assets/img/banner11.webp";
import banner12 from "../assets/img/banner12.webp";
import banner13 from "../assets/img/banner13.jpg";
import banner14 from "../assets/img/banner14.png";
import banner16 from "../assets/img/banner16.webp";

const images = [
  { img: banner1, caption: "As Beautiful As You" },
  { img: banner2, caption: "Ancient Love Poetry" },
  { img: banner3, caption: "Best Choice Ever" },
  { img: banner4, caption: "Sword and Fairy" },
  { img: banner5, caption: "She and Her Perpfect Husaband" },
  { img: banner6, caption: "Arsenal Military Academy" },
  { img: banner7, caption: "Snow Eagle Lord" },
  { img: banner8, caption: "Arsenal Military Academy" },
  { img: banner9, caption: "Wonderland of Love" },
  { img: banner10, caption: "Wonderland of Love" },
  { img: banner11, caption: "The Legends" },
  { img: banner12, caption: "Court Lady" },
  { img: banner13, caption: "Royal Feast" },
  { img: banner14, caption: "Story of Yanxi Palace" },
  { img: banner16, caption: "Falling into your smile " },
];
---

<div class="banner-carousel">
  {
    images.map((item) => (
      <figure>
        <Image src={item.img} alt="banner" class="image" format="avif" />
        <span class="caption">{item.caption}</span>
      </figure>
    ))
  }
</div>

<style>
  .banner-carousel {
    z-index: -2;
    width: 100%;
    height: 100%;
    position: relative;
    /* background-color: red; */
  }
  figure {
    /* background-color: blue; */
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 1s ease-in-out;
  }
  .caption {
    position: absolute;
    bottom: 0.5rem;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.6);
    padding: 0.4rem 1rem;
    font-size: 0.8rem;
    white-space: nowrap; /* Force text to stay on a single line */
  }
  .image {
    z-index: inherit;
    height: 100%;
    width: 100%;
    object-fit: cover;
  }

  .fade-in {
    opacity: 1;
  }
  .fade-out {
    opacity: 0;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const carousels = document.querySelectorAll(".banner-carousel");

    carousels.forEach((carousel) => {
      const images = carousel.querySelectorAll("figure");
      const totalImages = images.length;
      let currentIndex = Math.floor(Math.random() * totalImages); // Randomly select initial index
      const transitionDelay = 10000; // Total delay for each image transition (4 seconds)
      const fadeDuration = 1000; // Duration of fade in and out (1 second)

      function showNextImage() {
        console.log("running", currentIndex, currentIndex, new Date());

        // Fade out the current image
        images[currentIndex].classList.remove("fade-in");
        images[currentIndex].classList.add("fade-out");
        console.log(images[currentIndex].nextElementSibling);

        // Move to the next image
        currentIndex = (currentIndex + 1) % images.length;

        // Fade in the next image
        images[currentIndex].classList.remove("fade-out");
        images[currentIndex].classList.add("fade-in");

        // Set timeout to manage the total delay including fade duration
        setTimeout(showNextImage, transitionDelay);
      }

      // Initialize the first image
      images[currentIndex].classList.add("fade-in");

      // Start the transition sequence
      setTimeout(showNextImage, transitionDelay);
    });
  });
</script>
